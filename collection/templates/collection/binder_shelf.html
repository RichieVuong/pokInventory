{% extends 'base.html' %}

{% block content %}
<div class="min-h-[80vh] flex flex-col items-center justify-center p-8">

    {% if not binders %}
    <!-- Empty State: Create First Binder -->
    <div class="max-w-md w-full text-center bg-gray-800 p-8 rounded-2xl shadow-2xl">
        <div class="text-6xl mb-6">âœ¨</div>
        <h2 class="text-3xl font-bold mb-4 text-white">Create Your First Binder</h2>
        <p class="text-gray-400 mb-8">Every great collection starts with a name. What should we call yours?</p>

        <form action="{% url 'create_binder' %}" method="POST" class="space-y-4">
            {% csrf_token %}
            <input type="text" name="name"
                class="w-full bg-gray-900 border border-gray-700 text-white rounded-lg py-3 px-4 focus:ring-2 focus:ring-yellow-500 focus:outline-none"
                placeholder="e.g. My Best Cards, Charizard Collection..." required>
            <button type="submit"
                class="w-full py-3 bg-red-600 hover:bg-red-500 text-white font-bold rounded-lg shadow-lg hover:shadow-red-500/50 transition">
                Create Binder
            </button>
        </form>
    </div>

    {% else %}
    <!-- Bookshelf: List of Binders -->
    <div class="w-full max-w-6xl">
        <h1 class="text-4xl font-bold mb-10 text-center text-white">Your Collection</h1>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
            {% for binder in binders %}
            <a href="{% url 'binder_page' binder.id 1 %}"
                class="group relative aspect-[3/4] bg-red-600 rounded-lg shadow-xl overflow-hidden hover:scale-105 hover:shadow-2xl transition duration-300 transform perspective-1000">
                <div class="absolute inset-0 bg-gradient-to-br from-white/10 to-black/20"></div>
                <!-- Spine effect -->
                <div class="absolute left-0 top-0 bottom-0 w-6 bg-black/20 border-r border-black/10"></div>

                <div class="absolute inset-0 flex flex-col items-center justify-center p-6 text-center text-white">
                    <div
                        class="w-24 h-24 rounded-full border-4 border-white/20 mb-4 bg-white/10 backdrop-blur flex items-center justify-center">
                        <span class="text-4xl">ðŸ“•</span>
                    </div>
                    <h3 class="text-2xl font-bold mb-2 group-hover:text-yellow-300 transition">{{ binder.name }}
                    </h3>
                    <p class="opacity-70 text-sm">{{ binder.cards.count }} Cards</p>
                </div>
            </a>
            {% endfor %}

            <!-- Create New Binder Card -->
            {% if binders|length < 3 %} <div id="new-binder-card"
                class="aspect-[3/4] bg-gray-800 rounded-lg border-2 border-dashed border-gray-600 flex flex-col items-center justify-center hover:border-yellow-500 hover:bg-gray-750 transition cursor-pointer p-6 relative group"
                onclick="toggleNewBinder(this)">

                <!-- Initial View: Just the Plus -->
                <div id="initial-view"
                    class="absolute inset-0 flex flex-col items-center justify-center transition-opacity duration-300">
                    <h3 class="text-xl font-bold text-gray-400 mb-4 group-hover:text-yellow-400 transition">New Binder
                    </h3>
                    <div
                        class="w-16 h-16 rounded-full bg-gray-700 group-hover:bg-yellow-600 text-white flex items-center justify-center shadow-lg transition-all duration-300 transform group-hover:scale-110">
                        <span class="text-4xl pb-1">+</span>
                    </div>
                </div>

                <!-- Form View: Hidden Initially -->
                <form id="form-view" action="{% url 'create_binder' %}" method="POST"
                    class="w-full text-center hidden opacity-0 transition-opacity duration-300"
                    onclick="event.stopPropagation()">
                    {% csrf_token %}
                    <h3 class="text-xl font-bold text-gray-200 mb-4">Name Your Binder</h3>
                    <input type="text" name="name"
                        class="w-full bg-gray-900 border border-gray-700 text-white rounded-lg py-3 px-4 mb-3 text-base focus:ring-2 focus:ring-yellow-500 focus:outline-none placeholder-gray-500"
                        placeholder="e.g. Rare Holos..." required autocomplete="off">
                    <button type="submit"
                        class="w-full py-2 bg-yellow-600 hover:bg-yellow-500 text-white font-bold rounded-lg shadow-lg transition">
                        Create
                    </button>
                    <button type="button" onclick="resetNewBinder(event)"
                        class="mt-2 text-gray-500 hover:text-gray-300 text-sm underline">Cancel</button>
                </form>
        </div>

        <script>
            function toggleNewBinder(card) {
                const initialView = card.querySelector('#initial-view');
                const formView = card.querySelector('#form-view');
                const input = formView.querySelector('input');

                if (formView.classList.contains('hidden')) {
                    // Switch to Form
                    initialView.classList.add('opacity-0', 'pointer-events-none');
                    setTimeout(() => {
                        initialView.classList.add('hidden');
                        formView.classList.remove('hidden');
                        // Small delay to allow display:block to apply before opacity transition
                        requestAnimationFrame(() => {
                            formView.classList.remove('opacity-0');
                            input.focus();
                        });
                    }, 200);

                    // Disable card click while form is active (handled by stopPropagation on form)
                    card.onclick = null;
                }
            }

            function resetNewBinder(event) {
                event.stopPropagation();
                const card = document.getElementById('new-binder-card');
                const initialView = card.querySelector('#initial-view');
                const formView = card.querySelector('#form-view');

                formView.classList.add('opacity-0');
                setTimeout(() => {
                    formView.classList.add('hidden');
                    initialView.classList.remove('hidden');
                    requestAnimationFrame(() => {
                        initialView.classList.remove('opacity-0', 'pointer-events-none');
                    });
                }, 200);

                // Re-enable toggle
                setTimeout(() => {
                    card.onclick = function () { toggleNewBinder(this); };
                }, 200);
            }
        </script>
        {% endif %}
    </div>
</div>
{% endif %}

</div>
{% endblock %}